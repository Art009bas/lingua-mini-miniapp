<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Проклятые руины: Битва за Артефакт</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap');
        
        :root {
            --primary-dark: #1a2a32;
            --primary-gold: #d4af37;
            --primary-emerald: #50c878;
            --secondary-dark: #0d1b2a;
            --secondary-gold: #f9d423;
        }
        
        body {
            font-family: 'MedievalSharp', cursive;
            background-color: var(--primary-dark);
            color: white;
            touch-action: manipulation;
            user-select: none;
            padding-top: 180px; /* Отступ для фиксированной шапки */
        }
        
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: var(--secondary-dark);
            z-index: 50;
            padding: 10px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .game-cell {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            background-color: var(--secondary-dark);
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }
        
        .game-cell.active {
            box-shadow: 0 0 15px var(--primary-gold);
        }
        
        .game-cell.special {
            background: radial-gradient(circle, var(--primary-emerald) 0%, var(--secondary-dark) 70%);
        }
        
        .player {
            width: 70%;
            height: 70%;
            border-radius: 50%;
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            transition: all 0.5s ease;
            z-index: 10;
            font-size: 24px;
        }
        
        .player-human {
            background-color: var(--primary-gold);
            box-shadow: 0 0 10px var(--primary-gold);
        }
        
        .player-ai {
            background-color: var(--primary-emerald);
            box-shadow: 0 0 10px var(--primary-emerald);
        }
        
        .dice {
            width: 60px;
            height: 60px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1s ease;
            margin: 0 auto;
        }
        
        .dice-face {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 10px;
            background: white;
            border: 2px solid var(--primary-gold);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-dark);
        }
        
        .dice-face:nth-child(1) { transform: rotateY(0deg) translateZ(30px); }
        .dice-face:nth-child(2) { transform: rotateY(90deg) translateZ(30px); }
        .dice-face:nth-child(3) { transform: rotateX(90deg) translateZ(30px); }
        .dice-face:nth-child(4) { transform: rotateX(-90deg) translateZ(30px); }
        .dice-face:nth-child(5) { transform: rotateY(-90deg) translateZ(30px); }
        .dice-face:nth-child(6) { transform: rotateY(180deg) translateZ(30px); }
        
        @keyframes shake {
            0% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(-5px) rotate(-5deg); }
            50% { transform: translateX(5px) rotate(5deg); }
            75% { transform: translateX(-5px) rotate(-5deg); }
            100% { transform: translateX(0) rotate(0deg); }
        }
        
        .shake {
            animation: shake 0.5s ease infinite;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-content {
            background-color: var(--secondary-dark);
            border: 3px solid var(--primary-gold);
            border-radius: 15px;
            padding: 20px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .modal.active .modal-content {
            transform: scale(1);
        }
        
        .event-icon {
            font-size: 30px;
            margin-bottom: 10px;
        }
        
        .btn {
            background-color: var(--primary-gold);
            color: var(--primary-dark);
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            font-family: 'MedievalSharp', cursive;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 rgba(0,0,0,0.2);
        }
        
        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 rgba(0,0,0,0.2);
        }
        
        .btn-secondary {
            background-color: var(--primary-emerald);
        }
        
        .btn-disabled {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .progress-bar {
            height: 10px;
            background-color: var(--secondary-dark);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--primary-gold);
            transition: width 0.3s ease;
        }
        
        .log-entry {
            padding: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 14px;
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .log-human {
            color: var(--primary-gold);
        }
        
        .log-ai {
            color: var(--primary-emerald);
        }
        
        .log-event {
            color: white;
        }
        
        @media (max-width: 640px) {
            body {
                padding-top: 220px; /* Больший отступ для мобильных */
            }
            
            .dice {
                width: 40px;
                height: 40px;
            }
            
            .dice-face {
                font-size: 18px;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 16px;
            }
            
            .player {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <!-- Фиксированная шапка с управлением -->
    <div class="header">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center mb-2">
                <h2 id="gameStatus" class="text-xl font-bold text-yellow-300">Твой ход</h2>
                <div class="flex items-center space-x-2">
                    <div class="bg-gray-800 px-3 py-1 rounded-full">
                        <span id="turnCounter">Ход: 1</span>
                    </div>
                </div>
            </div>
            
            <!-- Панель управления -->
            <div class="bg-gray-800 rounded-lg p-4">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="flex items-center space-x-4">
                        <div class="text-center">
                            <div class="dice" id="dice1">
                                <div class="dice-face">1</div>
                                <div class="dice-face">2</div>
                                <div class="dice-face">3</div>
                                <div class="dice-face">4</div>
                                <div class="dice-face">5</div>
                                <div class="dice-face">6</div>
                            </div>
                            <span class="text-sm mt-1 block">Кубик 1</span>
                        </div>
                        <div class="text-center">
                            <div class="dice" id="dice2">
                                <div class="dice-face">1</div>
                                <div class="dice-face">2</div>
                                <div class="dice-face">3</div>
                                <div class="dice-face">4</div>
                                <div class="dice-face">5</div>
                                <div class="dice-face">6</div>
                            </div>
                            <span class="text-sm mt-1 block">Кубик 2</span>
                        </div>
                    </div>
                    
                    <div class="flex flex-col space-y-2 w-full md:w-auto">
                        <button id="rollDiceBtn" class="btn">Бросить кубики</button>
                        <button id="specialAbilityBtn" class="btn btn-secondary opacity-50 pointer-events-none">Перепроверка</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Интро модальное окно -->
    <div id="introModal" class="modal active">
        <div class="modal-content text-center p-6 max-w-md">
            <h1 class="text-3xl font-bold mb-4 text-yellow-300">Проклятые руины: Битва за Артефакт</h1>
            <div class="mb-6">
                <p class="mb-3">Ты — отважный искатель приключений, проникший в древние проклятые руины, чтобы найти легендарный Артефакт Вечности.</p>
                <p class="mb-3">По слухам, тот, кто первым доберётся до него, получит власть управлять временем.</p>
                <p class="mb-3">Но ты не один. За Артефактом охотится таинственный соперник — ИИ-археолог АрхаЙОН, цифровой разум, активированный самим Храмом.</p>
            </div>
            <div class="mb-6 text-left">
                <h2 class="text-xl font-bold mb-2 text-yellow-300">Правила игры:</h2>
                <ul class="list-disc pl-5 space-y-1">
                    <li>Бросай кубик дважды за ход</li>
                    <li>Продвигайся по полю на сумму очков</li>
                    <li>Выполняй задания и преодолевай препятствия</li>
                    <li>Первый достигший последней клетки побеждает!</li>
                </ul>
            </div>
            <div class="flex flex-col space-y-3">
                <input type="text" id="playerName" placeholder="Введи своё имя" class="px-4 py-2 rounded bg-gray-800 border border-yellow-300 text-white text-center" value="Рейдер">
                <button id="startGameBtn" class="btn">Начать экспедицию</button>
            </div>
        </div>
    </div>
    
    <!-- Игровое поле -->
    <div class="container mx-auto px-4 py-6">
        <div class="flex flex-col lg:flex-row gap-6">
            <!-- Основное игровое поле -->
            <div class="flex-grow">
                <!-- Игровое поле -->
                <div id="gameBoard" class="grid grid-cols-10 gap-2 mb-6">
                    <!-- Клетки будут сгенерированы через JS -->
                </div>
            </div>
            
            <!-- Боковая панель -->
            <div class="w-full lg:w-64 bg-gray-800 rounded-lg p-4 flex flex-col">
                <h3 class="text-lg font-bold mb-3 text-yellow-300">Журнал экспедиции</h3>
                <div id="gameLog" class="flex-grow overflow-y-auto mb-4 max-h-64">
                    <!-- Записи журнала будут добавляться через JS -->
                </div>
                
                <div class="mt-auto">
                    <div class="mb-4">
                        <h4 class="font-bold mb-1">Рейдер</h4>
                        <div class="progress-bar">
                            <div id="playerProgress" class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <h4 class="font-bold mb-1">АрхаЙОН</h4>
                        <div class="progress-bar">
                            <div id="aiProgress" class="progress-fill bg-emerald-500" style="width: 0%"></div>
                        </div>
                    </div>
                    <button id="restartGameBtn" class="btn w-full">Начать заново</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Модальное окно события -->
    <div id="eventModal" class="modal">
        <div class="modal-content text-center p-6 max-w-md">
            <div id="eventIcon" class="event-icon">⚡</div>
            <h2 id="eventTitle" class="text-2xl font-bold mb-3 text-yellow-300">Событие</h2>
            <p id="eventDescription" class="mb-6">Описание события</p>
            <div id="eventOptions" class="flex flex-col space-y-3">
                <!-- Варианты ответов будут добавляться динамически -->
            </div>
        </div>
    </div>
    
    <!-- Модальное окно конца игры -->
    <div id="endGameModal" class="modal">
        <div class="modal-content text-center p-6 max-w-md">
            <h2 id="endGameTitle" class="text-3xl font-bold mb-4 text-yellow-300">Победа!</h2>
            <p id="endGameMessage" class="mb-6">Ты овладел Артефактом! Время — в твоих руках…</p>
            <button id="playAgainBtn" class="btn">Играть снова</button>
        </div>
    </div>
    
    <script>
        // Константы игры
        const BOARD_COLS = 10;
        const BOARD_ROWS = 20;
        const TOTAL_CELLS = BOARD_COLS * BOARD_ROWS;
        
        // Типы событий на клетках
        const EVENT_TYPES = {
            NORMAL: 0,
            QUESTION: 1,
            OBSTACLE: 2,
            BONUS: 3,
            TRAP: 4,
            PUZZLE: 5,
            RIDDLE: 6,
            SWAP: 7,
            EXTRA_TURN: 8
        };
        
        // Состояние игры
        let gameState = {
            playerPosition: 0,
            aiPosition: 0,
            currentPlayer: 'human',
            turn: 1,
            dice1Value: 1,
            dice2Value: 1,
            diceRolled: false,
            specialAbilityUsed: false,
            gameStarted: false,
            playerName: 'Рейдер',
            events: [],
            waitingForEvent: false // Флаг ожидания завершения события
        };
        
        // Вопросы и задания
        const QUESTIONS = [
            {
                question: "Какой символ означает 'вечность' в древнем языке руин?",
                options: ["∞", "Δ", "Ψ", "Θ"],
                answer: 0
            },
            {
                question: "Какое из этих существ охраняет руины?",
                options: ["Каменный голем", "Огненный дракон", "Призрак прошлого", "Все варианты"],
                answer: 3
            },
            {
                question: "Какой элемент активирует механизм двери?",
                options: ["Вода", "Огонь", "Земля", "Воздух"],
                answer: 1
            }
        ];
        
        const RIDDLES = [
            {
                riddle: "Я бесконечен в начале и конце, но ограничен в середине. Что я?",
                answer: "буква Е"
            },
            {
                riddle: "Чем больше берёшь, тем больше оставляешь. Что это?",
                answer: "шаги"
            }
        ];
        
        const SYMBOLS = ["∞", "Δ", "Ψ", "Θ", "Σ", "Ω", "Φ", "Λ"];
        
        // Инициализация игры
        function initGame() {
            generateBoard();
            updateUI();
            addLogEntry("Экспедиция началась! Кто первым достигнет Артефакта?", 'event');
            
            // Генерация событий на поле
            generateEvents();
        }
        
        // Генерация игрового поля
        function generateBoard() {
            const gameBoard = document.getElementById('gameBoard');
            gameBoard.innerHTML = '';
            
            for (let row = 0; row < BOARD_ROWS; row++) {
                for (let col = 0; col < BOARD_COLS; col++) {
                    const cellIndex = row * BOARD_COLS + col;
                    const cell = document.createElement('div');
                    cell.className = 'game-cell';
                    cell.dataset.index = cellIndex;
                    
                    // Добавляем номер клетки (только для отладки)
                    const cellNumber = document.createElement('span');
                    cellNumber.className = 'absolute top-1 left-1 text-xs text-gray-500';
                    cellNumber.textContent = cellIndex + 1;
                    cell.appendChild(cellNumber);
                    
                    gameBoard.appendChild(cell);
                }
            }
        }
        
        // Генерация случайных событий на поле
        function generateEvents() {
            gameState.events = Array(TOTAL_CELLS).fill(EVENT_TYPES.NORMAL);
            
            // Устанавливаем специальные события на определенные клетки
            const specialCells = [
                {index: 5, type: EVENT_TYPES.QUESTION},
                {index: 12, type: EVENT_TYPES.OBSTACLE},
                {index: 18, type: EVENT_TYPES.BONUS},
                {index: 25, type: EVENT_TYPES.TRAP},
                {index: 33, type: EVENT_TYPES.PUZZLE},
                {index: 42, type: EVENT_TYPES.RIDDLE},
                {index: 50, type: EVENT_TYPES.SWAP},
                {index: 58, type: EVENT_TYPES.EXTRA_TURN},
                {index: 65, type: EVENT_TYPES.QUESTION},
                {index: 72, type: EVENT_TYPES.OBSTACLE},
                {index: 80, type: EVENT_TYPES.BONUS},
                {index: 88, type: EVENT_TYPES.TRAP},
                {index: 95, type: EVENT_TYPES.PUZZLE},
                {index: 105, type: EVENT_TYPES.RIDDLE},
                {index: 115, type: EVENT_TYPES.SWAP},
                {index: 125, type: EVENT_TYPES.EXTRA_TURN},
                {index: 135, type: EVENT_TYPES.QUESTION},
                {index: 145, type: EVENT_TYPES.OBSTACLE},
                {index: 155, type: EVENT_TYPES.BONUS},
                {index: 165, type: EVENT_TYPES.TRAP},
                {index: 175, type: EVENT_TYPES.PUZZLE},
                {index: 185, type: EVENT_TYPES.RIDDLE},
                {index: 195, type: EVENT_TYPES.SWAP}
            ];
            
            specialCells.forEach(cell => {
                if (cell.index < TOTAL_CELLS) {
                    gameState.events[cell.index] = cell.type;
                    
                    // Добавляем визуальный маркер на клетку
                    const cellElement = document.querySelector(`.game-cell[data-index="${cell.index}"]`);
                    if (cellElement) {
                        cellElement.classList.add('special');
                        
                        const eventMarker = document.createElement('div');
                        eventMarker.className = 'absolute bottom-1 right-1 text-lg';
                        
                        switch (cell.type) {
                            case EVENT_TYPES.QUESTION:
                                eventMarker.textContent = '?';
                                break;
                            case EVENT_TYPES.OBSTACLE:
                                eventMarker.textContent = '⚠';
                                break;
                            case EVENT_TYPES.BONUS:
                                eventMarker.textContent = '↑';
                                break;
                            case EVENT_TYPES.TRAP:
                                eventMarker.textContent = '↓';
                                break;
                            case EVENT_TYPES.PUZZLE:
                                eventMarker.textContent = '⌗';
                                break;
                            case EVENT_TYPES.RIDDLE:
                                eventMarker.textContent = '❓';
                                break;
                            case EVENT_TYPES.SWAP:
                                eventMarker.textContent = '⇄';
                                break;
                            case EVENT_TYPES.EXTRA_TURN:
                                eventMarker.textContent = '↻';
                                break;
                        }
                        
                        cellElement.appendChild(eventMarker);
                    }
                }
            });
        }
        
        // Обновление интерфейса
        function updateUI() {
            // Обновляем позиции игроков
            updatePlayerPositions();
            
            // Обновляем статус игры
            document.getElementById('turnCounter').textContent = `Ход: ${gameState.turn}`;
            
            // Обновляем прогресс
            document.getElementById('playerProgress').style.width = `${(gameState.playerPosition / (TOTAL_CELLS - 1)) * 100}%`;
            document.getElementById('aiProgress').style.width = `${(gameState.aiPosition / (TOTAL_CELLS - 1)) * 100}%`;
            
            // Обновляем кнопки
            const rollDiceBtn = document.getElementById('rollDiceBtn');
            const specialAbilityBtn = document.getElementById('specialAbilityBtn');
            
            if (gameState.currentPlayer === 'human' && !gameState.diceRolled && !gameState.waitingForEvent) {
                rollDiceBtn.classList.remove('btn-disabled');
                document.getElementById('gameStatus').textContent = `${gameState.playerName}, твой ход`;
            } else if (gameState.currentPlayer === 'human' && gameState.diceRolled) {
                rollDiceBtn.classList.add('btn-disabled');
                document.getElementById('gameStatus').textContent = `${gameState.playerName}, выполни задание`;
            } else {
                rollDiceBtn.classList.add('btn-disabled');
                document.getElementById('gameStatus').textContent = `Ход АрхаЙОНа`;
            }
            
            if (!gameState.specialAbilityUsed && gameState.diceRolled && gameState.currentPlayer === 'human') {
                specialAbilityBtn.classList.remove('opacity-50', 'pointer-events-none');
            } else {
                specialAbilityBtn.classList.add('opacity-50', 'pointer-events-none');
            }
            
            // Подсвечиваем активную клетку
            document.querySelectorAll('.game-cell').forEach(cell => {
                cell.classList.remove('active');
            });
            
            const activePlayer = gameState.currentPlayer === 'human' ? gameState.playerPosition : gameState.aiPosition;
            const activeCell = document.querySelector(`.game-cell[data-index="${activePlayer}"]`);
            if (activeCell) {
                activeCell.classList.add('active');
            }
        }
        
        // Обновление позиций игроков на поле
        function updatePlayerPositions() {
            // Удаляем предыдущие позиции
            document.querySelectorAll('.player').forEach(player => player.remove());
            
            // Добавляем игрока
            const playerCell = document.querySelector(`.game-cell[data-index="${gameState.playerPosition}"]`);
            if (playerCell) {
                const playerElement = document.createElement('div');
                playerElement.className = 'player player-human';
                playerElement.textContent = '🧭'; // Эмодзи компаса для игрока
                playerCell.appendChild(playerElement);
            }
            
            // Добавляем ИИ
            const aiCell = document.querySelector(`.game-cell[data-index="${gameState.aiPosition}"]`);
            if (aiCell) {
                const aiElement = document.createElement('div');
                aiElement.className = 'player player-ai';
                aiElement.textContent = '👁'; // Эмодзи глаза для ИИ
                aiCell.appendChild(aiElement);
            }
        }
        
        // Бросок кубиков
        function rollDice() {
            if (gameState.diceRolled || gameState.waitingForEvent) return;
            
            // Анимация кубиков
            const dice1 = document.getElementById('dice1');
            const dice2 = document.getElementById('dice2');
            
            dice1.classList.add('shake');
            dice2.classList.add('shake');
            
            setTimeout(() => {
                // Генерация случайных значений
                gameState.dice1Value = Math.floor(Math.random() * 6) + 1;
                gameState.dice2Value = Math.floor(Math.random() * 6) + 1;
                
                // Установка значений кубиков
                setDiceFace(dice1, gameState.dice1Value);
                setDiceFace(dice2, gameState.dice2Value);
                
                dice1.classList.remove('shake');
                dice2.classList.remove('shake');
                
                gameState.diceRolled = true;
                
                // Запись в журнал
                addLogEntry(`${gameState.playerName} бросает кубики: ${gameState.dice1Value} и ${gameState.dice2Value}`, 'human');
                
                // Перемещение игрока
                movePlayer();
                
                updateUI();
            }, 1000);
        }
        
        // Установка значения кубика
        function setDiceFace(diceElement, value) {
            const rotation = {
                1: 'rotateX(0deg) rotateY(0deg)',
                2: 'rotateX(0deg) rotateY(-90deg)',
                3: 'rotateX(-90deg) rotateY(0deg)',
                4: 'rotateX(90deg) rotateY(0deg)',
                5: 'rotateX(0deg) rotateY(90deg)',
                6: 'rotateX(0deg) rotateY(180deg)'
            };
            
            diceElement.style.transform = rotation[value];
        }
        
        // Перемещение игрока
        function movePlayer() {
            const totalSteps = gameState.dice1Value + gameState.dice2Value;
            let newPosition;
            
            if (gameState.currentPlayer === 'human') {
                newPosition = gameState.playerPosition + totalSteps;
                if (newPosition >= TOTAL_CELLS) {
                    newPosition = TOTAL_CELLS - 1;
                }
                gameState.playerPosition = newPosition;
                
                addLogEntry(`${gameState.playerName} перемещается на ${totalSteps} клеток`, 'human');
            } else {
                newPosition = gameState.aiPosition + totalSteps;
                if (newPosition >= TOTAL_CELLS) {
                    newPosition = TOTAL_CELLS - 1;
                }
                gameState.aiPosition = newPosition;
                
                addLogEntry(`АрхаЙОН перемещается на ${totalSteps} клеток`, 'ai');
            }
            
            // Проверка на победу
            if (!checkWinCondition()) {
                // Если игра не закончилась, проверяем событие на клетке
                checkCellEvent();
            }
        }
        
        // Проверка события на клетке
        function checkCellEvent() {
            const position = gameState.currentPlayer === 'human' ? gameState.playerPosition : gameState.aiPosition;
            const eventType = gameState.events[position];
            
            gameState.waitingForEvent = true;
            
            switch (eventType) {
                case EVENT_TYPES.NORMAL:
                    if (gameState.currentPlayer === 'human') {
                        setTimeout(() => {
                            gameState.waitingForEvent = false;
                            endTurn();
                        }, 1000);
                    } else {
                        setTimeout(() => {
                            gameState.waitingForEvent = false;
                            endTurn();
                        }, 1500);
                    }
                    break;
                    
                case EVENT_TYPES.QUESTION:
                    showQuestionEvent();
                    break;
                    
                case EVENT_TYPES.OBSTACLE:
                    showObstacleEvent();
                    break;
                    
                case EVENT_TYPES.BONUS:
                    showBonusEvent();
                    break;
                    
                case EVENT_TYPES.TRAP:
                    showTrapEvent();
                    break;
                    
                case EVENT_TYPES.PUZZLE:
                    showPuzzleEvent();
                    break;
                    
                case EVENT_TYPES.RIDDLE:
                    showRiddleEvent();
                    break;
                    
                case EVENT_TYPES.SWAP:
                    showSwapEvent();
                    break;
                    
                case EVENT_TYPES.EXTRA_TURN:
                    showExtraTurnEvent();
                    break;
                    
                default:
                    gameState.waitingForEvent = false;
                    endTurn();
                    break;
            }
        }
        
        // Показать событие-вопрос
        function showQuestionEvent() {
            const question = QUESTIONS[Math.floor(Math.random() * QUESTIONS.length)];
            
            document.getElementById('eventIcon').textContent = '❓';
            document.getElementById('eventTitle').textContent = 'Мистический символ';
            document.getElementById('eventDescription').textContent = question.question;
            
            const optionsContainer = document.getElementById('eventOptions');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.textContent = option;
                btn.addEventListener('click', () => {
                    handleQuestionAnswer(index === question.answer);
                });
                optionsContainer.appendChild(btn);
            });
            
            showEventModal();
        }
        
        // Обработка ответа на вопрос
        function handleQuestionAnswer(isCorrect) {
            hideEventModal();
            
            if (gameState.currentPlayer === 'human') {
                if (isCorrect) {
                    addLogEntry(`${gameState.playerName} правильно ответил на вопрос и получает бонус!`, 'event');
                    // Бонус за правильный ответ
                    gameState.playerPosition = Math.min(gameState.playerPosition + 2, TOTAL_CELLS - 1);
                    updatePlayerPositions();
                } else {
                    addLogEntry(`${gameState.playerName} ошибся в ответе и теряет ход!`, 'event');
                }
            } else {
                // ИИ имеет 50% шанс ошибиться
                const aiCorrect = Math.random() > 0.5;
                
                if (aiCorrect) {
                    addLogEntry(`АрхаЙОН правильно расшифровал символ и получает бонус!`, 'event');
                    gameState.aiPosition = Math.min(gameState.aiPosition + 2, TOTAL_CELLS - 1);
                } else {
                    addLogEntry(`АрхаЙОН ошибся в расшифровке символа!`, 'event');
                }
                
                updatePlayerPositions();
            }
            
            setTimeout(() => {
                gameState.waitingForEvent = false;
                if (!checkWinCondition()) {
                    endTurn();
                }
            }, 1000);
        }
        
        // Показать событие-препятствие
        function showObstacleEvent() {
            document.getElementById('eventIcon').textContent = '⚠';
            document.getElementById('eventTitle').textContent = 'Проклятие времени';
            document.getElementById('eventDescription').textContent = 'Ты активировал древнее проклятие! Тебя отбрасывает назад.';
            
            const optionsContainer = document.getElementById('eventOptions');
            optionsContainer.innerHTML = '';
            
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.textContent = 'Продолжить';
            btn.addEventListener('click', () => {
                hideEventModal();
                
                if (gameState.currentPlayer === 'human') {
                    addLogEntry(`${gameState.playerName} активировал проклятие времени!`, 'event');
                    gameState.playerPosition = Math.max(0, gameState.playerPosition - 3);
                } else {
                    addLogEntry(`АрхаЙОН активировал проклятие времени!`, 'event');
                    gameState.aiPosition = Math.max(0, gameState.aiPosition - 3);
                }
                
                updatePlayerPositions();
                
                setTimeout(() => {
                    gameState.waitingForEvent = false;
                    if (!checkWinCondition()) {
                        endTurn();
                    }
                }, 1000);
            });
            
            optionsContainer.appendChild(btn);
            
            showEventModal();
        }
        
        // Показать событие-бонус
        function showBonusEvent() {
            document.getElementById('eventIcon').textContent = '↑';
            document.getElementById('eventTitle').textContent = 'Бонус факела';
            document.getElementById('eventDescription').textContent = 'Ты нашёл скрытый ход! Продвигаешься вперёд.';
            
            const optionsContainer = document.getElementById('eventOptions');
            optionsContainer.innerHTML = '';
            
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.textContent = 'Продолжить';
            btn.addEventListener('click', () => {
                hideEventModal();
                
                if (gameState.currentPlayer === 'human') {
                    addLogEntry(`${gameState.playerName} нашёл скрытый ход!`, 'event');
                    gameState.playerPosition = Math.min(TOTAL_CELLS - 1, gameState.playerPosition + 2);
                } else {
                    addLogEntry(`АрхаЙОН нашёл скрытый ход!`, 'event');
                    gameState.aiPosition = Math.min(TOTAL_CELLS - 1, gameState.aiPosition + 2);
                }
                
                updatePlayerPositions();
                
                setTimeout(() => {
                    gameState.waitingForEvent = false;
                    if (!checkWinCondition()) {
                        endTurn();
                    }
                }, 1000);
            });
            
            optionsContainer.appendChild(btn);
            
            showEventModal();
        }
        
        // Показать событие-ловушку
        function showTrapEvent() {
            document.getElementById('eventIcon').textContent = '↓';
            document.getElementById('eventTitle').textContent = 'Призрак прошлого';
            document.getElementById('eventDescription').textContent = 'Призрак прошлого замораживает тебя! Ты пропускаешь ход.';
            
            const optionsContainer = document.getElementById('eventOptions');
            optionsContainer.innerHTML = '';
            
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.textContent = 'Продолжить';
            btn.addEventListener('click', () => {
                hideEventModal();
                
                if (gameState.currentPlayer === 'human') {
                    addLogEntry(`${gameState.playerName} встретил призрака прошлого и пропускает ход!`, 'event');
                } else {
                    addLogEntry(`АрхаЙОН встретил призрака прошлого и пропускает ход!`, 'event');
                }
                
                setTimeout(() => {
                    gameState.waitingForEvent = false;
                    if (!checkWinCondition()) {
                        endTurn();
                    }
                }, 1000);
            });
            
            optionsContainer.appendChild(btn);
            
            showEventModal();
        }
        
        // Показать событие-головоломку
        function showPuzzleEvent() {
            const correctSymbol = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
            const options = [correctSymbol];
            
            // Генерация 3 случайных неправильных вариантов
            while (options.length < 4) {
                const randomSymbol = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
                if (!options.includes(randomSymbol)) {
                    options.push(randomSymbol);
                }
            }
            
            // Перемешиваем варианты
            options.sort(() => Math.random() - 0.5);
            
            document.getElementById('eventIcon').textContent = '⌗';
            document.getElementById('eventTitle').textContent = 'Древний код';
            document.getElementById('eventDescription').textContent = 'Выбери правильный символ, чтобы открыть дверь:';
            
            const optionsContainer = document.getElementById('eventOptions');
            optionsContainer.innerHTML = '';
            
            options.forEach((symbol, index) => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.textContent = symbol;
                btn.addEventListener('click', () => {
                    handlePuzzleAnswer(symbol === correctSymbol);
                });
                optionsContainer.appendChild(btn);
            });
            
            showEventModal();
        }
        
        // Обработка ответа на головоломку
        function handlePuzzleAnswer(isCorrect) {
            hideEventModal();
            
            if (gameState.currentPlayer === 'human') {
                if (isCorrect) {
                    addLogEntry(`${gameState.playerName} правильно выбрал символ и проходит дальше!`, 'event');
                } else {
                    addLogEntry(`${gameState.playerName} ошибся в выборе символа и теряет ход!`, 'event');
                }
            } else {
                // ИИ имеет 60% шанс ошибиться
                const aiCorrect = Math.random() > 0.4;
                
                if (aiCorrect) {
                    addLogEntry(`АрхаЙОН правильно выбрал символ и проходит дальше!`, 'event');
                } else {
                    addLogEntry(`АрхаЙОН ошибся в выборе символа!`, 'event');
                }
            }
            
            setTimeout(() => {
                gameState.waitingForEvent = false;
                if (!checkWinCondition()) {
                    endTurn();
                }
            }, 1000);
        }
        
        // Показать событие-загадку
        function showRiddleEvent() {
            const riddle = RIDDLES[Math.floor(Math.random() * RIDDLES.length)];
            
            document.getElementById('eventIcon').textContent = '❓';
            document.getElementById('eventTitle').textContent = 'Битва разума';
            document.getElementById('eventDescription').textContent = riddle.riddle;
            
            const optionsContainer = document.getElementById('eventOptions');
            optionsContainer.innerHTML = '';
            
            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder = 'Твой ответ...';
            input.className = 'px-4 py-2 rounded bg-gray-800 border border-yellow-300 text-white w-full mb-3';
            optionsContainer.appendChild(input);
            
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.textContent = 'Ответить';
            btn.addEventListener('click', () => {
                const answer = input.value.trim().toLowerCase();
                handleRiddleAnswer(answer === riddle.answer.toLowerCase());
            });
            optionsContainer.appendChild(btn);
            
            showEventModal();
        }
        
        // Обработка ответа на загадку
        function handleRiddleAnswer(isCorrect) {
            hideEventModal();
            
            if (gameState.currentPlayer === 'human') {
                if (isCorrect) {
                    addLogEntry(`${gameState.playerName} правильно разгадал загадку и получает бонус!`, 'event');
                    gameState.playerPosition = Math.min(gameState.playerPosition + 3, TOTAL_CELLS - 1);
                    updatePlayerPositions();
                } else {
                    addLogEntry(`${gameState.playerName} не смог разгадать загадку!`, 'event');
                }
            } else {
                // ИИ имеет 70% шанс ошибиться
                const aiCorrect = Math.random() > 0.3;
                
                if (aiCorrect) {
                    addLogEntry(`АрхаЙОН правильно разгадал загадку и получает бонус!`, 'event');
                    gameState.aiPosition = Math.min(gameState.aiPosition + 3, TOTAL_CELLS - 1);
                } else {
                    addLogEntry(`АрхаЙОН не смог разгадать загадку!`, 'event');
                }
                
                updatePlayerPositions();
            }
            
            setTimeout(() => {
                gameState.waitingForEvent = false;
                if (!checkWinCondition()) {
                    endTurn();
                }
            }, 1000);
        }
        
        // Показать событие-обмен
        function showSwapEvent() {
            document.getElementById('eventIcon').textContent = '⇄';
            document.getElementById('eventTitle').textContent = 'Паутина иллюзий';
            document.getElementById('eventDescription').textContent = 'Иллюзии руин запутали вас! Вы меняетесь местами с соперником.';
            
            const optionsContainer = document.getElementById('eventOptions');
            optionsContainer.innerHTML = '';
            
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.textContent = 'Продолжить';
            btn.addEventListener('click', () => {
                hideEventModal();
                
                const temp = gameState.playerPosition;
                gameState.playerPosition = gameState.aiPosition;
                gameState.aiPosition = temp;
                
                addLogEntry(`Паутина иллюзий поменяла местами ${gameState.playerName} и АрхаЙОНа!`, 'event');
                
                updatePlayerPositions();
                
                setTimeout(() => {
                    gameState.waitingForEvent = false;
                    if (!checkWinCondition()) {
                        endTurn();
                    }
                }, 1000);
            });
            
            optionsContainer.appendChild(btn);
            
            showEventModal();
        }
        
        // Показать событие-дополнительный ход
        function showExtraTurnEvent() {
            document.getElementById('eventIcon').textContent = '↻';
            document.getElementById('eventTitle').textContent = 'Сосуд удачи';
            document.getElementById('eventDescription').textContent = 'Ты нашёл сосуд удачи! Получаешь дополнительный ход.';
            
            const optionsContainer = document.getElementById('eventOptions');
            optionsContainer.innerHTML = '';
            
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.textContent = 'Продолжить';
            btn.addEventListener('click', () => {
                hideEventModal();
                
                if (gameState.currentPlayer === 'human') {
                    addLogEntry(`${gameState.playerName} нашёл сосуд удачи и получает дополнительный ход!`, 'event');
                } else {
                    addLogEntry(`АрхаЙОН нашёл сосуд удачи и получает дополнительный ход!`, 'event');
                }
                
                setTimeout(() => {
                    gameState.diceRolled = false;
                    gameState.waitingForEvent = false;
                    updateUI();
                    
                    if (gameState.currentPlayer === 'ai') {
                        setTimeout(() => {
                            aiTurn();
                        }, 1000);
                    }
                }, 1000);
            });
            
            optionsContainer.appendChild(btn);
            
            showEventModal();
        }
        
        // Показать модальное окно события
        function showEventModal() {
            if (gameState.currentPlayer === 'ai') {
                // Для ИИ автоматически закрываем окно через 2 секунды
                setTimeout(() => {
                    hideEventModal();
                    
                    // ИИ принимает случайное решение
                    if (document.getElementById('eventTitle').textContent === 'Битва разума') {
                        handleRiddleAnswer(Math.random() > 0.3);
                    } else if (document.getElementById('eventTitle').textContent === 'Древний код') {
                        handlePuzzleAnswer(Math.random() > 0.4);
                    } else if (document.getElementById('eventTitle').textContent === 'Мистический символ') {
                        handleQuestionAnswer(Math.random() > 0.5);
                    } else {
                        // Для других событий просто нажимаем первую кнопку
                        const btn = document.querySelector('#eventOptions .btn');
                        if (btn) {
                            btn.click();
                        } else {
                            gameState.waitingForEvent = false;
                            endTurn();
                        }
                    }
                }, 2000);
            }
            
            document.getElementById('eventModal').classList.add('active');
        }
        
        // Скрыть модальное окно события
        function hideEventModal() {
            document.getElementById('eventModal').classList.remove('active');
        }
        
        // Ход ИИ
        function aiTurn() {
            if (gameState.currentPlayer !== 'ai' || gameState.waitingForEvent) return;
            
            addLogEntry('АрхаЙОН размышляет...', 'ai');
            
            setTimeout(() => {
                rollDice();
            }, 1500);
        }
        
        // Завершение хода
        function endTurn() {
            gameState.diceRolled = false;
            
            if (gameState.currentPlayer === 'human') {
                gameState.currentPlayer = 'ai';
                updateUI();
                
                setTimeout(() => {
                    aiTurn();
                }, 1000);
            } else {
                gameState.currentPlayer = 'human';
                gameState.turn++;
                updateUI();
            }
        }
        
        // Проверка условия победы
        function checkWinCondition() {
            if (gameState.playerPosition >= TOTAL_CELLS - 1) {
                gameState.playerPosition = TOTAL_CELLS - 1;
                showEndGame(true);
                return true;
            } else if (gameState.aiPosition >= TOTAL_CELLS - 1) {
                gameState.aiPosition = TOTAL_CELLS - 1;
                showEndGame(false);
                return true;
            }
            return false;
        }
        
        // Показать экран конца игры
        function showEndGame(isPlayerWinner) {
            const endGameModal = document.getElementById('endGameModal');
            const endGameTitle = document.getElementById('endGameTitle');
            const endGameMessage = document.getElementById('endGameMessage');
            
            if (isPlayerWinner) {
                endGameTitle.textContent = 'Победа!';
                endGameMessage.textContent = 'Ты овладел Артефактом! Время — в твоих руках…';
                addLogEntry(`${gameState.playerName} достиг Артефакта и победил!`, 'event');
            } else {
                endGameTitle.textContent = 'Поражение';
                endGameMessage.textContent = 'АрхаЙОН остановил тебя. Руины останутся вечно запечатанными…';
                addLogEntry(`АрхаЙОН достиг Артефакта первым!`, 'event');
            }
            
            endGameModal.classList.add('active');
        }
        
        // Специальная способность игрока
        function useSpecialAbility() {
            if (gameState.specialAbilityUsed || !gameState.diceRolled || gameState.currentPlayer !== 'human') return;
            
            gameState.specialAbilityUsed = true;
            
            // Перебрасываем один кубик
            const diceToReroll = Math.random() > 0.5 ? 'dice1' : 'dice2';
            const diceElement = document.getElementById(diceToReroll);
            
            diceElement.classList.add('shake');
            
            setTimeout(() => {
                const newValue = Math.floor(Math.random() * 6) + 1;
                
                if (diceToReroll === 'dice1') {
                    gameState.dice1Value = newValue;
                } else {
                    gameState.dice2Value = newValue;
                }
                
                setDiceFace(diceElement, newValue);
                diceElement.classList.remove('shake');
                
                addLogEntry(`${gameState.playerName} использует Перепроверку и перебрасывает кубик!`, 'human');
                
                // Пересчитываем движение
                const totalSteps = gameState.dice1Value + gameState.dice2Value;
                const newPosition = Math.min(gameState.playerPosition + totalSteps, TOTAL_CELLS - 1);
                
                // Если позиция изменилась
                if (newPosition !== gameState.playerPosition) {
                    gameState.playerPosition = newPosition;
                    addLogEntry(`${gameState.playerName} перемещается на ${totalSteps} клеток`, 'human');
                    updatePlayerPositions();
                    
                    // Проверяем событие на новой клетке
                    setTimeout(() => {
                        checkCellEvent();
                    }, 1000);
                } else {
                    updateUI();
                }
                
                checkWinCondition();
            }, 1000);
        }
        
        // Добавление записи в журнал
        function addLogEntry(text, type = 'event') {
            const logElement = document.getElementById('gameLog');
            const entry = document.createElement('div');
            
            entry.className = 'log-entry';
            if (type === 'human') entry.classList.add('log-human');
            else if (type === 'ai') entry.classList.add('log-ai');
            else entry.classList.add('log-event');
            
            entry.textContent = text;
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        // Перезапуск игры
        function restartGame() {
            gameState = {
                playerPosition: 0,
                aiPosition: 0,
                currentPlayer: 'human',
                turn: 1,
                dice1Value: 1,
                dice2Value: 1,
                diceRolled: false,
                specialAbilityUsed: false,
                gameStarted: true,
                playerName: gameState.playerName,
                events: [],
                waitingForEvent: false
            };
            
            document.getElementById('gameLog').innerHTML = '';
            document.getElementById('endGameModal').classList.remove('active');
            document.getElementById('eventModal').classList.remove('active');
            
            initGame();
        }
        
        // Обработчики событий
        document.getElementById('rollDiceBtn').addEventListener('click', rollDice);
        document.getElementById('specialAbilityBtn').addEventListener('click', useSpecialAbility);
        document.getElementById('restartGameBtn').addEventListener('click', restartGame);
        document.getElementById('playAgainBtn').addEventListener('click', restartGame);
        document.getElementById('startGameBtn').addEventListener('click', () => {
            const nameInput = document.getElementById('playerName');
            gameState.playerName = nameInput.value.trim() || 'Рейдер';
            gameState.gameStarted = true;
            document.getElementById('introModal').classList.remove('active');
            initGame();
        });
        
        // Инициализация при загрузке
        window.addEventListener('DOMContentLoaded', () => {
            // Устанавливаем начальные значения кубиков
            setDiceFace(document.getElementById('dice1'), 1);
            setDiceFace(document.getElementById('dice2'), 1);
        });
    </script>
</body>
</html>
